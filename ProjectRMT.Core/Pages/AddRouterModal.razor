@using System.Drawing;
@using MudBlazor;
@using Project_RMT.Interfaces;
@using Project_RMT.Models;
@using Router = Project_RMT.Models.Router;
@using System.Net;

<MudForm @ref="form">
    <MudDialog>
        <DialogContent>
            <MudGrid>
                <MudItem xs="12" md="12">
                    <MudTextField Style="background-color: grey;" T="string" Label="IPadress" @ref="ipField" />
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField Style="background-color: grey;" T="int" Label="X-Coordinates" @ref="xcoordinateField"/>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField Style="background-color: grey;" T="int" Label="Y-Coordinates" @ref="ycoordinateField"/>
                </MudItem>
                @if (NetworkInterfaces is not null && NetworkInterfaces.Count != 0)
                {
                    <MudSelect T="Router" Label="NetworkInterfaces" MultiSelection="true" @bind-SelectedValues="options">
                        @foreach (var networkInterface in NetworkInterfaces)
                        {
                            <MudSelectItem Value="@networkInterface">@networkInterface.Id.ToString()</MudSelectItem>
                        }
                    </MudSelect>
                }
            </MudGrid>
            <MudButton @onclick="save" Variant="Variant.Filled" Color="MudBlazor.Color.Primary" Class="ml-auto">Register</MudButton>
        </DialogContent>
    </MudDialog>
</MudForm>


@code {
    [Parameter] public List<Router> NetworkInterfaces { get; set; }
    MudTextField<string> ipField;
    MudTextField<int> xcoordinateField;
    MudTextField<int> ycoordinateField;
    MudForm form;
    private IEnumerable<Router> options { get; set; } = new HashSet<Router>();

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private void save()
    {
        var newRouter = new Router()
        {
            Id = Guid.NewGuid(),
            Clients = new List<Models.Client>(),
            IPAdress = IPAddress.Parse(ipField.Value),
            NetworkInterfaces = new List<NetworkInterface>(),
            RoutingTable = new(),
            Coordinates = new Point(xcoordinateField.Value, ycoordinateField.Value)
        };

        foreach (var item in options)
        {
            newRouter.NetworkInterfaces.Add(new NetworkInterface() { Name = item.IPAdress.ToString(), ConnectedNetworkDevice = item });
        }

        MudDialog.Close(DialogResult.Ok(newRouter));
    }
}